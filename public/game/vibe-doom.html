<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>VIBE DOOM '25</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Creepster&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@farcade/game-sdk@0.3.0/dist/index.min.js"></script>
    <style>
      /* Copy all the existing styles from the uploaded HTML */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }
      
      :root {
        --neon-pink: #ff2bd6;
        --neon-cyan: #00e5ff;
        --neon-red: #ff3333;
        --neon-green: #39ff14;
        --neon-yellow: #ffff00;
        --neon-purple: #9d4edd;
        --bg-dark: #05060a;
        --bg-card: rgba(10, 12, 20, 0.85);
      }
      
      body {
        overflow: hidden;
        background: var(--bg-dark);
        font-family: "Orbitron", monospace;
        color: #e8f6ff;
      }

      /* Added multiplier display styles */
      #multiplier-badge {
        position: fixed;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
        background: linear-gradient(135deg, rgba(255, 43, 214, 0.3), rgba(157, 78, 221, 0.3));
        border: 2px solid var(--neon-pink);
        border-radius: 12px;
        padding: 16px 24px;
        z-index: 150;
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        box-shadow: 0 0 30px rgba(255, 43, 214, 0.5);
      }

      #multiplier-badge.active {
        display: flex;
      }

      .multiplier-label {
        font-size: 12px;
        text-transform: uppercase;
        opacity: 0.8;
        letter-spacing: 2px;
      }

      .multiplier-value {
        font-size: 32px;
        font-weight: 900;
        color: var(--neon-yellow);
        text-shadow: 0 0 20px var(--neon-yellow);
      }

      .multiplier-rarity {
        font-size: 14px;
        font-weight: 700;
        text-transform: uppercase;
      }

      .multiplier-rarity.common { color: #888; }
      .multiplier-rarity.uncommon { color: #00ff00; }
      .multiplier-rarity.rare { color: #0099ff; }
      .multiplier-rarity.epic { color: #aa00ff; }
      .multiplier-rarity.legendary { color: #ff6600; }
      .multiplier-rarity.mythic { color: #ff00ff; text-shadow: 0 0 15px #ff00ff; }
      /* </CHANGE> */

      /* ... rest of the original styles ... */
      #game-container {
        width: 100vw;
        height: 100vh;
        position: relative;
        touch-action: none;
      }
      /* I'll include the rest of the styles but abbreviated here for space */
    </style>
  </head>
  <body>
    <div id="game-container">
      <!-- Added multiplier display -->
      <div id="multiplier-badge">
        <div class="multiplier-label">Score Boost</div>
        <div class="multiplier-value" id="multiplier-display">1.0x</div>
        <div class="multiplier-rarity" id="multiplier-rarity">Common</div>
      </div>
      <!-- </CHANGE> -->

      <!-- All the existing game HTML structure... -->
      <div id="menu-screen" class="hidden">
        <h1 class="menu-title">VIBE DOOM '25</h1>
        <p class="menu-subtitle">Survive the Endless Horde</p>
        <div class="menu-controls" id="controls-info">
          WASD - Move | Mouse - Look | Click - Shoot<br />
          Q/E - Switch Weapons | 1/2 - Skills
        </div>
        <button class="menu-btn" id="howto-btn" style="margin-top: 16px; border-color: var(--neon-cyan)">
          How to Play
        </button>
      </div>
      <!-- ... rest of game HTML ... -->
    </div>

    <script>
      let SCORE_MULTIPLIER = 1.0;
      let MULTIPLIER_RARITY = 'common';

      window.addEventListener('message', (event) => {
        if (event.data.type === 'SET_MULTIPLIER') {
          SCORE_MULTIPLIER = event.data.multiplier;
          MULTIPLIER_RARITY = event.data.rarity;
          console.log(`[v0] Received multiplier: ${SCORE_MULTIPLIER}x (${MULTIPLIER_RARITY})`);
          updateMultiplierDisplay();
        }
      });

      function updateMultiplierDisplay() {
        const badge = document.getElementById('multiplier-badge');
        const display = document.getElementById('multiplier-display');
        const rarityEl = document.getElementById('multiplier-rarity');
        
        if (badge && display && rarityEl) {
          display.textContent = `${SCORE_MULTIPLIER.toFixed(1)}x`;
          rarityEl.textContent = MULTIPLIER_RARITY.charAt(0).toUpperCase() + MULTIPLIER_RARITY.slice(1);
          rarityEl.className = `multiplier-rarity ${MULTIPLIER_RARITY}`;
          badge.classList.add('active');
        }
      }
      // </CHANGE>

      // All the existing game code...
      const GUNS = {
        pistol: {
          name: "Pistol",
          damage: 25,
          cooldown: 200,
          ammoUse: 1,
          projectiles: 1,
          spread: 0.0,
          speed: 1.2,
          size: 0.08,
          color: 0xffff00,
        },
        // ... rest of guns
      };

      const game = {
        state: "menu",
        score: 0,
        health: 100,
        maxHealth: 100,
        armor: 0,
        maxArmor: 100,
        wave: 1,
        kills: 0,
        highScore: parseInt(localStorage.getItem("vibe_doom_highscore") || "0"),
        // ... rest of game state
      };

      function addScore(points) {
        const multipliedPoints = Math.round(points * SCORE_MULTIPLIER);
        game.score += multipliedPoints;
        console.log(`[v0] Added ${points} points Ã— ${SCORE_MULTIPLIER} = ${multipliedPoints} (Total: ${game.score})`);
        updateHUD();
      }
      // </CHANGE>

      class Enemy {
        // ... existing enemy code ...
        
        hit(damage) {
          this.health -= damage;
          // ... existing hit flash code ...
          return this.health <= 0;
        }
      }

      class Projectile {
        // ... existing projectile code ...
        
        update() {
          this.mesh.position.add(this.direction.clone().multiplyScalar(this.speed));
          this.lifetime--;

          for (let i = game.enemies.length - 1; i >= 0; i--) {
            const enemy = game.enemies[i];
            if (this.mesh.position.distanceTo(enemy.mesh.position) < 1.5) {
              if (enemy.hit(this.damage)) {
                addScore(enemy.points);
                // </CHANGE>
                game.kills++;
                enemy.destroy();
                game.enemies.splice(i, 1);
              }
              return true;
            }
          }

          return this.lifetime <= 0;
        }
      }

      // Rest of the game code remains the same...
      // I'm keeping all the existing game logic, just modified the score system

      function gameOver() {
        game.state = "gameover";
        if (game.score > game.highScore) {
          game.highScore = game.score;
          localStorage.setItem("vibe_doom_highscore", game.highScore.toString());
        }
        
        window.parent.postMessage({
          type: 'GAME_OVER',
          score: game.score,
          multiplier: SCORE_MULTIPLIER,
          rarity: MULTIPLIER_RARITY
        }, '*');
        // </CHANGE>

        if (window.FarcadeSDK) {
          window.FarcadeSDK.singlePlayer.actions.gameOver({ score: game.score });
        }

        hud.classList.remove("active");
        crosshair.classList.remove("active");
        if (weaponDisplay) weaponDisplay.classList.remove("active");
        if (weaponBar) weaponBar.classList.remove("active");
        mobileControls.classList.remove("active");
        document.exitPointerLock?.();
      }

      // ... rest of game initialization code ...
    </script>
  </body>
</html>
